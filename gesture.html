<!DOCTYPE html>
<html>
<head>
<title>Gesture Engine</title>

<!-- MediaPipe -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<style>
  body { margin:0; background:transparent; }
  video {
    width:1px;
    height:1px;
    opacity:0;
    position:fixed;
  }
</style>
</head>
<body>

<video id="video" autoplay></video>

<script>
let lastSwipe = 0;

function sendAction(action) {
  // Home page ke liye event bhejte hain
  window.parent.postMessage({ type: "gesture", action: action }, "*");
}

// --- MediaPipe setup ---
const video = document.getElementById("video");

const hands = new Hands({
  locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});
hands.setOptions({
  maxNumHands: 1,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});

hands.onResults(results => {
  if (!results.multiHandLandmarks[0]) return;

  const lm = results.multiHandLandmarks[0];

  const palmX = lm[0].x;
  const thumbX = lm[4].x;

  // === Swipe Left ===
  if (thumbX - palmX > 0.25) {
    if (Date.now() - lastSwipe > 800) {
      sendAction("left");
      lastSwipe = Date.now();
    }
  }

  // === Swipe Right ===
  if (palmX - thumbX > 0.25) {
    if (Date.now() - lastSwipe > 800) {
      sendAction("right");
      lastSwipe = Date.now();
    }
  }

  // === Open Hand ===
  let openHand =
    lm[8].y < lm[6].y &&
    lm[12].y < lm[10].y &&
    lm[16].y < lm[14].y &&
    lm[20].y < lm[18].y;

  if (openHand) sendAction("open");

  // === Fist ===
  let fist =
    lm[8].y > lm[6].y &&
    lm[12].y > lm[10].y &&
    lm[16].y > lm[14].y &&
    lm[20].y > lm[18].y;

  if (fist) sendAction("fist");

  // === Pointing ===
  let point =
    lm[8].y < lm[6].y &&
    lm[12].y > lm[10].y &&
    lm[16].y > lm[14].y &&
    lm[20].y > lm[18].y;

  if (point) sendAction("point");
});

// Camera start
const camera = new Camera(video, {
  onFrame: async () => hands.send({ image: video }),
  width: 640,
  height: 480
});
camera.start();

</script>
</body>
</html>
